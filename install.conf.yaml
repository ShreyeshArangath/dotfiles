- defaults:
    link:
      relink: true
      create: true

- clean: ['~']

- create:
    - ~/.config
    - ~/.zsh
    - ~/.local/bin
    - ~/.cache

- link:
    ~/.zshrc: zsh/.zshrc
    ~/.gitconfig: git/.gitconfig
    ~/.tmux.conf: tmux/.tmux.conf
    ~/.config/nvim: nvim

- shell:
    - description: Installing platform-specific packages
      command: |
        OS="$(uname -s)"
        case "${OS}" in
          Darwin*)
            # macOS - use Homebrew
            if command -v brew >/dev/null 2>&1; then
              echo "Installing packages from Brewfile..."
              brew bundle --file=Brewfile || true
            else
              echo "Homebrew not found. Skipping macOS package installation."
            fi
            ;;
          Linux*)
            # Linux - packages should already be installed by bootstrap.sh
            echo "Linux detected. Essential packages installed by bootstrap.sh"
            ;;
          *)
            echo "Unknown OS. Skipping package installation."
            ;;
        esac
      stdout: true
      stderr: true

    - description: Installing Powerlevel10k
      command: |
        if [ ! -d "$HOME/.powerlevel10k" ]; then
          echo "Installing Powerlevel10k..."
          git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ~/.powerlevel10k
        else
          echo "Powerlevel10k already installed"
        fi
      stdout: true
      stderr: true

    - description: Installing zsh-autosuggestions
      command: |
        PLUGIN_DIR="$HOME/.zsh/zsh-autosuggestions"
        if [ ! -d "$PLUGIN_DIR" ]; then
          echo "Installing zsh-autosuggestions..."
          git clone https://github.com/zsh-users/zsh-autosuggestions "$PLUGIN_DIR"
        else
          echo "zsh-autosuggestions already installed"
        fi
      stdout: true
      stderr: true

    - description: Installing zsh-syntax-highlighting
      command: |
        PLUGIN_DIR="$HOME/.zsh/zsh-syntax-highlighting"
        if [ ! -d "$PLUGIN_DIR" ]; then
          echo "Installing zsh-syntax-highlighting..."
          git clone https://github.com/zsh-users/zsh-syntax-highlighting "$PLUGIN_DIR"
        else
          echo "zsh-syntax-highlighting already installed"
        fi
      stdout: true
      stderr: true

    - description: Installing Tmux Plugin Manager (TPM)
      command: |
        if [ ! -d "$HOME/.tmux/plugins/tpm" ]; then
          echo "Installing Tmux Plugin Manager..."
          git clone https://github.com/tmux-plugins/tpm "$HOME/.tmux/plugins/tpm"
          echo "TPM installed successfully"
        else
          echo "TPM already installed"
        fi
      stdout: true
      stderr: true

    - description: Installing Tmux plugins
      command: |
        echo "Installing tmux plugins..."
        if [ -f "$HOME/.tmux/plugins/tpm/bin/install_plugins" ]; then
          # Set TMUX_PLUGIN_MANAGER_PATH for TPM
          export TMUX_PLUGIN_MANAGER_PATH="$HOME/.tmux/plugins"

          # Run TPM's install script
          bash "$HOME/.tmux/plugins/tpm/bin/install_plugins"

          # Verify plugins were installed
          if [ -d "$HOME/.tmux/plugins/tmux" ]; then
            echo "Catppuccin theme installed successfully"
          else
            echo "Warning: Catppuccin theme may not have installed correctly"
          fi

          if [ -d "$HOME/.tmux/plugins/tmux-yank" ]; then
            echo "tmux-yank installed successfully"
          else
            echo "Warning: tmux-yank may not have installed correctly"
          fi
        else
          echo "TPM not found, skipping plugin installation"
        fi
      stdout: true
      stderr: true

- shell:
    - description: Post-installation instructions
      command: |
        echo ""
        echo "=========================================="
        echo "  Dotfiles Installation Complete!"
        echo "=========================================="
        echo ""
        echo "Next steps:"
        echo "  1. Change shell to zsh: chsh -s \$(which zsh)"
        echo "  2. Restart your terminal or run: zsh"
        echo "  3. Open Neovim and run :Lazy sync to install plugins"
        echo "  4. Open tmux - plugins are already installed!"
        echo ""
        echo "For LinkedIn work machines:"
        echo "  1. Create ~/.zshrc.local with your work-specific configurations"
        echo "  2. Run: cp ~/dotfiles/git/.gitconfig.linkedin ~/.gitconfig.local"
        echo "  3. Restart your terminal"
        echo ""
        echo "SSH key management:"
        echo "  - personal_ssh  : Load personal SSH key"
        echo "  - work_ssh      : Load LinkedIn SSH key (work machines)"
        echo "  - reload_ssh_keys : Load both keys (work machines)"
        echo ""
      stdout: true
